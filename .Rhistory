setwd("D:\\GitRepos\\work")
library(ggplot2)
library(scales)
library(TSA)
source("fun\\GenerateStatsDataFrame.R")
## data directory (external directory for input and output)
basedir = "D:\\Experiments\\R\\"
## load data
DF1 = read.csv( paste0(basedir, "data\\allcheckins.csv"),
header=TRUE, sep=",", nrows=200000,
colClasses = c("numeric","numeric","numeric","character",
"numeric","character","character","character")
)
## add additional columns
DF1$datetime = strptime( strtrim(DF1$time_str,19),
format="%Y-%m-%d %H:%M:%S"
)
DF1$hour=format(DF1$datetime,"%H")
DF1$yearday=format(DF1$datetime,"%j")
DF1$weekday = ifelse(
(format(DF1$datetime,"%w")>5 | format(DF1$datetime,"%w")<1),
"Weekend", "Workday")
globalfre = spec.pgram(DF_date_hour$prop, plot=FALSE)
DF_date_hour = gen_df_by_date_hour(DF1)
globalfre = spec.pgram(DF_date_hour$prop, plot=FALSE)
period=1/freq
plot(globalfre[["freq"]][1:100],globalfre[["spec"]][1:100])
plot(globalfre[["freq"]][1:100],globalfre[["spec"]][1:100], type="l")
plot(globalfre[["freq"]][1:200],globalfre[["spec"]][1:200], type="l")
DF_date_hour_category = data.frame()
temp = lapply(L_category, function(i){
df = gen_df_by_date_hour(i, category = i[1,"cate_l1"])
DF_date_hour_category <<- rbind(DF_date_hour_category,df)
})
rm(temp)
L_category = split(DF1, DF1$cate_l1)
DF_date_hour_category = data.frame()
temp = lapply(L_category, function(i){
df = gen_df_by_date_hour(i, category = i[1,"cate_l1"])
DF_date_hour_category <<- rbind(DF_date_hour_category,df)
})
rm(temp)
L_date_hour_category=split(DF_date_hour_category)
L_date_hour_category=split(DF_date_hour_category,DF_date_hour_category$cate_l1)
temp=lapply(L_date_hour_category, function(i){print(names(i))})
par(mfrow=c(2,5))
lapply(L_date_hour_category, function(i){spec.pgram(i$prop)})
lapply(L_date_hour_category, function(i){fre = spec.pgram(i$prop, plot=FALSE); plot(fre[["freq"]][1:200], fre[["spec"]][1:200], type="l")})
globalfre = spec.pgram(DF_date_hour$prop, plot=FALSE)
png(paste0(basedir,"img\\plot_freq.png"),width=1000)
plot(globalfre[["freq"]][1:200],globalfre[["spec"]][1:200], type="l")
dev.off()
L_date_hour_category=split(DF_date_hour_category,DF_date_hour_category$cate_l1)
par(mfrow=c(2,5))
png(paste0(basedir,"img\\plot_freq_category.png"),width=1000)
temp = lapply(L_date_hour_category, function(i){
fre = spec.pgram(i$prop, plot=FALSE)
plot(fre[["freq"]][1:200], fre[["spec"]][1:200], type="l")
})
dev.off()
par(mfrow=c(2,5))
png(paste0(basedir,"img\\plot_freq_category.png"),width=1000)
par(mfrow=c(2,5))
temp = lapply(L_date_hour_category, function(i){
fre = spec.pgram(i$prop, plot=FALSE)
plot(fre[["freq"]][1:200], fre[["spec"]][1:200], type="l")
})
dev.off()
png(paste0(basedir,"img\\plot_windSp.png"),width=1500)
ggplot(DF2, aes(x=datetime, y=WindSpd.Te)) +
geom_point(aes(x=datetime, y=WindSpd.Te)) +
geom_line() +
xlab("")
dev.off()
L_date_hour_category=split(DF_date_hour_category,DF_date_hour_category$cate_l1)
png(paste0(basedir,"img\\plot_freq_category.png"),width=1500)
par(mfrow=c(2,5))
temp = lapply(L_date_hour_category, function(i){
fre = spec.pgram(i$prop, plot=FALSE)
plot(fre[["freq"]][1:200], fre[["spec"]][1:200], type="l")
})
dev.off()
??ggplot
globalfre = spec.pgram(DF_date_hour$prop, plot=FALSE)
globalfre_df = data.frame(freq=globalfre[["freq"]], sepc=globalfre[["spec"]])
png(paste0(basedir,"img\\plot_freq.png"),width=1000)
#plot(globalfre[["freq"]][1:200],globalfre[["spec"]][1:200], type="l")
ggplot(globalfre_df, aes(x=freq, y=spec)) + geom_line()
dev.off()
ggplot(globalfre_df, aes(x=freq, y=spec)) + geom_line(aes(x=freq, y=spec))
globalfre = spec.pgram(DF_date_hour$prop, plot=FALSE)
png(paste0(basedir,"img\\plot_freq.png"),width=1000)
plot(globalfre[["freq"]][1:150],globalfre[["spec"]][1:150], type="l")
dev.off()
L_date_hour_category=split(DF_date_hour_category,DF_date_hour_category$cate_l1)
png(paste0(basedir,"img\\plot_freq_category.png"),width=1500)
par(mfrow=c(2,5))
temp = lapply(L_date_hour_category, function(i){
fre = spec.pgram(i$prop, plot=FALSE)
plot(fre[["freq"]][1:150], fre[["spec"]][1:150], type="l")
})
dev.off()
globalfre = spec.pgram(DF_date_hour$prop, plot=FALSE)
png(paste0(basedir,"img\\plot_freq.png"),width=1000)
plot(globalfre[["freq"]][1:150],globalfre[["spec"]][1:150],
type="l", xlab("Frequency"), ylab("Spectrum"),
main="Global frequency-spectrum")
dev.off()
plot(globalfre[["freq"]][1:150],globalfre[["spec"]][1:150],
type="l", #xlab("Frequency"), ylab("Spectrum"),
main="Global frequency-spectrum")
plot(globalfre[["freq"]][1:150],globalfre[["spec"]][1:150],
type="l", #xlab("Frequency"), ylab("Spectrum"),
main="Global frequency-spectrum")
png(paste0(basedir,"img\\plot_freq.png"),width=1000)
plot(globalfre[["freq"]][1:150],globalfre[["spec"]][1:150],
type="l", #xlab("Frequency"), ylab("Spectrum"),
main="Global frequency-spectrum")
dev.off()
plot(globalfre[["freq"]][1:150],globalfre[["spec"]][1:150],
type="l", xlab("Frequency"), ylab("Spectrum"),
main="Global frequency-spectrum")
png(paste0(basedir,"img\\plot_freq.png"),width=1000)
plot(globalfre[["freq"]][1:150],globalfre[["spec"]][1:150],
type="l", main="Global frequency-spectrum",
xlab="Frequency", ylab="Spectrum")
dev.off()
png(paste0(basedir,"img\\plot_freq.png"))
plot(globalfre[["freq"]][1:150],globalfre[["spec"]][1:150],
type="l", main="Global frequency-spectrum",
xlab="Frequency", ylab="Spectrum")
dev.off()
png(paste0(basedir,"img\\plot_freq_category.png"),width=1500)
par(mfrow=c(2,5))
temp = lapply(seq_along(L_date_hour_category), function(i){
fre = spec.pgram(L_date_hour_category[[i]]$prop, plot=FALSE)
plot(fre[["freq"]][1:150], fre[["spec"]][1:150],
type="l", main=L_date_hour_category[i],
xlab="Frequency", ylab="Spectrum")
})
dev.off()
lapply(seq_along(L_date_hour_category), function(i){
fre = spec.pgram(L_date_hour_category[[i]]$prop, plot=FALSE)
plot(fre[["freq"]][1:150], fre[["spec"]][1:150],
type="l", #main= L_date_hour_category[i],
xlab="Frequency", ylab="Spectrum")
})
L_date_hour_category[i]
L_date_hour_category[1]
names(L_date_hour_category[1])
png(paste0(basedir,"img\\plot_freq_category.png"),width=1500)
par(mfrow=c(2,5))
temp = lapply(seq_along(L_date_hour_category), function(i){
fre = spec.pgram(L_date_hour_category[[i]]$prop, plot=FALSE)
plot(fre[["freq"]][1:150], fre[["spec"]][1:150],
type="l", main= names(L_date_hour_category[i]),
xlab="Frequency", ylab="Spectrum")
})
dev.off()
png(paste0(basedir,"img\\plot_freq_category.png"),width=1000)
par(mfrow=c(2,5))
temp = lapply(seq_along(L_date_hour_category), function(i){
fre = spec.pgram(L_date_hour_category[[i]]$prop, plot=FALSE)
plot(fre[["freq"]][1:150], fre[["spec"]][1:150],
type="l", main= names(L_date_hour_category[i]),
xlab="Frequency", ylab="Spectrum")
})
dev.off()
globalfre = spec.pgram(DF_date_hour$prop, plot=FALSE)
png(paste0(basedir,"img\\plot_freq.png"))
plot(globalfre[["freq"]][1:180],globalfre[["spec"]][1:180],
type="l", main="Global frequency-spectrum",
xlab="Frequency", ylab="Spectrum")
dev.off()
L_date_hour_category=split(DF_date_hour_category,DF_date_hour_category$cate_l1)
png(paste0(basedir,"img\\plot_freq_category.png"),width=1000)
par(mfrow=c(2,5))
temp = lapply(seq_along(L_date_hour_category), function(i){
fre = spec.pgram(L_date_hour_category[[i]]$prop, plot=FALSE)
plot(fre[["freq"]][1:180], fre[["spec"]][1:180],
type="l", main= names(L_date_hour_category[i]),
xlab="Frequency", ylab="Spectrum")
})
dev.off()
x=0:pi/50:4*pi;
y=sin(0.5.*x)
x=0:pi/50:4*pi;
y=sin(0.5*x)
x=c(1:10, by=2)
pi
x=c(0:4*pi, by=pi/50)
x=c(0:4*pi, by=(pi/50))
end = 4*pi
interval = pi/50
end/interval
x=c(0:end, by=interval)
x=c(0:end)
emd
end
interval
x=c(0:200*interval)
y=sin(0.5*x)
par(mfrow=c(1,1))
spec.pgram(y)
y=sin(x)
spec.pgram(y)
y=sin(5*x)
spec.pgram(y)
test=spec.pgram(y,plot=FALSE)
## differences (between DF_hour_category and DF_date_hour_category)
L_mean = split(DF_hour_category, DF_hour_category$cate_l1)
L_date = split(DF_date_hour_category, DF_date_hour_category$cate_l1)
DF_diff = data.frame()
temp = lapply(seq_along(L_mean), function(i){
mean_cate_i = L_mean[[i]]
date_cate_i = L_date[[i]]
for (j in 1:nrow(date_cate_i)){
idx= which(mean_cate_i$hour == date_cate_i[j,"hour"])
diff = date_cate_i[j,"prop"] - mean_cate_i[idx, "prop"]
date_cate_i[j,"difference"] = diff
}
DF_diff <<- rbind(DF_diff, date_cate_i)
})
rm(temp)
## plot
png(paste0(basedir,"img\\plot_diff.png"),width=1000)
ggplot(DF_diff, aes(x=datetime, y=difference)) +
geom_point(aes(x=datetime, y=difference, color=weekday)) +
#geom_line() +
facet_wrap(~cate_l1, ncol=2, nrow=5) +
coord_cartesian(ylim = c(-0.1,0.3)) +
xlab("") +
scale_y_continuous(labels  = percent)
dev.off()
L_mean = split(DF_hour_category, DF_hour_category$cate_l1)
L_date = split(DF_date_hour_category, DF_date_hour_category$cate_l1)
DF_diff = data.frame()
temp = lapply(seq_along(L_mean), function(i){
mean_cate_i = L_mean[[i]]
date_cate_i = L_date[[i]]
for (j in 1:nrow(date_cate_i)){
idx= which(mean_cate_i$hour == date_cate_i[j,"hour"])
diff = date_cate_i[j,"prop"] - mean_cate_i[idx, "prop"]
date_cate_i[j,"difference"] = diff
}
DF_diff <<- rbind(DF_diff, date_cate_i)
})
rm(temp)
L_category = split(DF1, DF1$cate_l1)
DF_hour_category = data.frame()
temp = lapply(L_category, function(i){
df = gen_df_by_hour(i, category = i[1,"cate_l1"])
DF_hour_category <<- rbind(DF_hour_category,df)
})
rm(temp)
L_mean = split(DF_hour_category, DF_hour_category$cate_l1)
L_date = split(DF_date_hour_category, DF_date_hour_category$cate_l1)
DF_diff = data.frame()
temp = lapply(seq_along(L_mean), function(i){
mean_cate_i = L_mean[[i]]
date_cate_i = L_date[[i]]
for (j in 1:nrow(date_cate_i)){
idx= which(mean_cate_i$hour == date_cate_i[j,"hour"])
diff = date_cate_i[j,"prop"] - mean_cate_i[idx, "prop"]
date_cate_i[j,"difference"] = diff
}
DF_diff <<- rbind(DF_diff, date_cate_i)
})
rm(temp)
L_diff=split(DF_diff,DF_diff$cate_l1)
png(paste0(basedir,"img\\plot_diff_freq_category.png"),width=1000)
par(mfrow=c(2,5))
temp = lapply(seq_along(L_diff), function(i){
fre = spec.pgram(L_diff[[i]]$prop, plot=FALSE)
plot(fre[["freq"]][1:180], fre[["spec"]][1:180],
type="l", main= names(L_diff[i]),
xlab="Frequency", ylab="Spectrum")
})
dev.off()
png(paste0(basedir,"img\\plot_diff_freq_category.png"),width=1000)
par(mfrow=c(2,5))
temp = lapply(seq_along(L_diff), function(i){
fre = spec.pgram(L_diff[[i]]$difference, plot=FALSE)
plot(fre[["freq"]][1:180], fre[["spec"]][1:180],
type="l", main= names(L_diff[i]),
xlab="Frequency", ylab="Spectrum")
})
dev.off()
